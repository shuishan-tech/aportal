var travelMode,unitSystem;GMaps.prototype.getRoutes=function(s){switch(s.travelMode){case"bicycling":travelMode=google.maps.TravelMode.BICYCLING;break;case"transit":travelMode=google.maps.TravelMode.TRANSIT;break;case"driving":travelMode=google.maps.TravelMode.DRIVING;break;default:travelMode=google.maps.TravelMode.WALKING}unitSystem="imperial"===s.unitSystem?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC;var t=extend_object({avoidHighways:!1,avoidTolls:!1,optimizeWaypoints:!1,waypoints:[]},s);t.origin=/string/.test(typeof s.origin)?s.origin:new google.maps.LatLng(s.origin[0],s.origin[1]),t.destination=/string/.test(typeof s.destination)?s.destination:new google.maps.LatLng(s.destination[0],s.destination[1]),t.travelMode=travelMode,t.unitSystem=unitSystem,delete t.callback,delete t.error;var i=[];(new google.maps.DirectionsService).route(t,function(t,e){if(e===google.maps.DirectionsStatus.OK){for(var o in t.routes)t.routes.hasOwnProperty(o)&&i.push(t.routes[o]);s.callback&&s.callback(i,t,e)}else s.error&&s.error(t,e)})},GMaps.prototype.removeRoutes=function(){this.routes.length=0},GMaps.prototype.getElevations=function(t){0<(t=extend_object({locations:[],path:!1,samples:256},t)).locations.length&&0<t.locations[0].length&&(t.locations=array_flat(array_map([t.locations],arrayToLatLng,!1)));var o=t.callback;delete t.callback;var e,s=new google.maps.ElevationService;t.path?(e={path:t.locations,samples:t.samples},s.getElevationAlongPath(e,function(t,e){o&&"function"==typeof o&&o(t,e)})):(delete t.path,delete t.samples,s.getElevationForLocations(t,function(t,e){o&&"function"==typeof o&&o(t,e)}))},GMaps.prototype.cleanRoute=GMaps.prototype.removePolylines,GMaps.prototype.renderRoute=function(t,e){var s,o="string"==typeof e.panel?document.getElementById(e.panel.replace("#","")):e.panel;e.panel=o,e=extend_object({map:this.map},e),s=new google.maps.DirectionsRenderer(e),this.getRoutes({origin:t.origin,destination:t.destination,travelMode:t.travelMode,waypoints:t.waypoints,unitSystem:t.unitSystem,error:t.error,avoidHighways:t.avoidHighways,avoidTolls:t.avoidTolls,optimizeWaypoints:t.optimizeWaypoints,callback:function(t,e,o){o===google.maps.DirectionsStatus.OK&&s.setDirections(e)}})},GMaps.prototype.drawRoute=function(o){var s=this;this.getRoutes({origin:o.origin,destination:o.destination,travelMode:o.travelMode,waypoints:o.waypoints,unitSystem:o.unitSystem,error:o.error,avoidHighways:o.avoidHighways,avoidTolls:o.avoidTolls,optimizeWaypoints:o.optimizeWaypoints,callback:function(t){var e;0<t.length&&(e={path:t[t.length-1].overview_path,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight},o.hasOwnProperty("icons")&&(e.icons=o.icons),s.drawPolyline(e),o.callback&&o.callback(t[t.length-1]))}})},GMaps.prototype.travelRoute=function(a){if(a.origin&&a.destination)this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,waypoints:a.waypoints,unitSystem:a.unitSystem,error:a.error,callback:function(t){if(0<t.length&&a.start&&a.start(t[t.length-1]),0<t.length&&a.step){var e=t[t.length-1];if(0<e.legs.length)for(var o,s=e.legs[0].steps,i=0;o=s[i];i++)o.step_number=i,a.step(o,e.legs[0].steps.length-1)}0<t.length&&a.end&&a.end(t[t.length-1])}});else if(a.route&&0<a.route.legs.length)for(var t,e=a.route.legs[0].steps,o=0;t=e[o];o++)t.step_number=o,a.step(t)},GMaps.prototype.drawSteppedRoute=function(n){var r=this;if(n.origin&&n.destination)this.getRoutes({origin:n.origin,destination:n.destination,travelMode:n.travelMode,waypoints:n.waypoints,error:n.error,callback:function(t){if(0<t.length&&n.start&&n.start(t[t.length-1]),0<t.length&&n.step){var e=t[t.length-1];if(0<e.legs.length)for(var o,s=e.legs[0].steps,i=0;o=s[i];i++){o.step_number=i;var a={path:o.path,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeWeight:n.strokeWeight};n.hasOwnProperty("icons")&&(a.icons=n.icons),r.drawPolyline(a),n.step(o,e.legs[0].steps.length-1)}}0<t.length&&n.end&&n.end(t[t.length-1])}});else if(n.route&&0<n.route.legs.length)for(var t,e=n.route.legs[0].steps,o=0;t=e[o];o++){t.step_number=o;var s={path:t.path,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeWeight:n.strokeWeight};n.hasOwnProperty("icons")&&(s.icons=n.icons),r.drawPolyline(s),n.step(t)}},GMaps.Route=function(t){this.origin=t.origin,this.destination=t.destination,this.waypoints=t.waypoints,this.map=t.map,this.route=t.route,this.step_count=0,this.steps=this.route.legs[0].steps,this.steps_length=this.steps.length;var e={path:new google.maps.MVCArray,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight};t.hasOwnProperty("icons")&&(e.icons=t.icons),this.polyline=this.map.drawPolyline(e).getPath()},GMaps.Route.prototype.getRoute=function(t){var o=this;this.map.getRoutes({origin:this.origin,destination:this.destination,travelMode:t.travelMode,waypoints:this.waypoints||[],error:t.error,callback:function(){o.route=e[0],t.callback&&t.callback.call(o)}})},GMaps.Route.prototype.back=function(){if(0<this.step_count){this.step_count--;var t=this.route.legs[0].steps[this.step_count].path;for(var e in t)t.hasOwnProperty(e)&&this.polyline.pop()}},GMaps.Route.prototype.forward=function(){if(this.step_count<this.steps_length){var t=this.route.legs[0].steps[this.step_count].path;for(var e in t)t.hasOwnProperty(e)&&this.polyline.push(t[e]);this.step_count++}};