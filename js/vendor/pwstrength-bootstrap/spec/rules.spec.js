"use strict";var relaxedOptions,jsdom=require("jsdom").jsdom,jQuery=require("jquery"),rulesEngine=require("../src/rules.js"),options={common:{minChar:6,usernameField:"#username"},rules:{activated:{wordNotEmail:!0,wordMinLength:!0,wordMaxLength:!1,wordInvalidChar:!1,wordSimilarToUsername:!0,wordSequences:!0,wordTwoCharacterClasses:!1,wordRepetitions:!1,wordLowercase:!0,wordUppercase:!0,wordOneNumber:!0,wordThreeNumbers:!0,wordOneSpecialChar:!0,wordTwoSpecialChar:!0,wordUpperLowerCombo:!0,wordLetterNumberCombo:!0,wordLetterNumberCharCombo:!0,wordIsACommonPassword:!0},scores:{wordNotEmail:-100,wordMinLength:-50,wordMaxLength:-50,wordInvalidChar:-100,wordSimilarToUsername:-100,wordSequences:-50,wordTwoCharacterClasses:2,wordRepetitions:-25,wordLowercase:1,wordUppercase:3,wordOneNumber:3,wordThreeNumbers:5,wordOneSpecialChar:3,wordTwoSpecialChar:5,wordUpperLowerCombo:2,wordLetterNumberCombo:2,wordLetterNumberCharCombo:2,wordIsACommonPassword:-100},raisePower:1.4,commonPasswords:["123456","password","12345678","qwerty"]},ui:{spanError:function(e,t){return t}},instances:{errors:[]}},$=jQuery(jsdom().defaultView),strictOptions=$.extend(!0,{},options);strictOptions.rules.activated.wordTwoCharacterClasses=!0,strictOptions.rules.activated.wordRepetitions=!0,(relaxedOptions=$.extend(!0,{},options)).rules.activated.wordNotEmail=!1,relaxedOptions.rules.activated.wordMinLength=!1,relaxedOptions.rules.activated.wordSequences=!1,describe("Applying default rules",function(){it('to a common "password"',function(){expect(rulesEngine.executeRules(options,"password")).toEqual(-80.62082632004744)}),it('to a mixed "charsand19283746"',function(){expect(rulesEngine.executeRules(options,"charsand19283746")).toEqual(59.50293012833273)}),it("to one with upper cases",function(){expect(rulesEngine.executeRules(options,"QAZwsxTGByhn")).toEqual(38.423040924494714)}),it("to one with symbols",function(){expect(rulesEngine.executeRules(options,"qpwo#(ei*$&%^")).toEqual(47.26775666655811)}),it("to one with everything",function(){expect(rulesEngine.executeRules(options,"3vEr!t#iNg1$f!n3")).toEqual(74.50293012833274)}),it("to the perfect one",function(){expect(rulesEngine.executeRules(options,"qm2oUY!%$32znheSK&*3@#")).toEqual(101.75159003283396)}),it("to one with sequences",function(){expect(rulesEngine.executeRules(options,"qwertypasswdisbad")).toEqual(3.799339527161436)}),it("to one with reversed sequences",function(){expect(rulesEngine.executeRules(options,"0987ytrewqisbad")).toEqual(5.312654085941652)}),it("to one with an email",function(){expect(rulesEngine.executeRules(options,"test@example.com")).toEqual(-45.49706987166727)}),it('to a "short" one',function(){expect(rulesEngine.executeRules(options,"short")).toEqual(-39.48173030642061)})}),describe("Applying stricter rules",function(){it('to two-classes "passWORD"',function(){expect(rulesEngine.executeRules(strictOptions,"passWORD")).toEqual(26.379173679952558)}),it("to one with repetitions",function(){expect(rulesEngine.executeRules(strictOptions,"rreepppeatttt")).toEqual(12.267756666558107)})}),describe("Applying relaxed rules",function(){it("to one with sequences",function(){expect(rulesEngine.executeRules(relaxedOptions,"qwertypasswdisbad")).toEqual(1)}),it("to one with an email",function(){expect(rulesEngine.executeRules(relaxedOptions,"test@example.com")).toEqual(6)}),it('to a "short" one',function(){expect(rulesEngine.executeRules(relaxedOptions,"short")).toEqual(1)})}),describe("Looking for sequences",function(){beforeEach(function(){options.instances.errors=[]}),it("at the beginning of the password",function(){expect(rulesEngine.validation.wordSequences(options,"abcx",123)).toEqual(123)}),it("at the end of the password",function(){expect(rulesEngine.validation.wordSequences(options,"xabc",123)).toEqual(123)}),it("and not finding them",function(){expect(rulesEngine.validation.wordSequences(options,"mdiw93jc65oak$&!",123)).toEqual(0)})});